{% extends "base.html" %}

{% block title %}Tarjetas de Crédito - Finanzas Personales{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Tarjetas de Crédito</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{{ url_for('main.create_credit_card') }}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Nueva Tarjeta
            </a>
        </div>
    </div>
</div>

{% if credit_cards %}
<div class="row">
    {% for card in credit_cards %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ card.card_name }}</h5>
                <p class="text-muted">{{ card.bank_name }}</p>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">Utilización</small>
                        <small class="text-muted">{{ "%.1f"|format(card.get_utilization_percentage()) }}%</small>
                    </div>
                    <div class="progress">
                        <div class="progress-bar {% if card.get_utilization_percentage() > 70 %}bg-danger{% elif card.get_utilization_percentage() > 30 %}bg-warning{% else %}bg-success{% endif %}" 
                             style="width: {{ card.get_utilization_percentage() }}%">
                        </div>
                    </div>
                </div>
                
                <div class="row text-center mb-3">
                    <div class="col-6">
                        <small class="text-muted">Saldo Actual</small>
                        <h6 class="text-danger">${{ "%.2f"|format(card.current_balance) }}</h6>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Límite</small>
                        <h6>${{ "%.2f"|format(card.credit_limit) }}</h6>
                    </div>
                </div>
                
                <div class="row text-center mb-3">
                    <div class="col-6">
                        <small class="text-muted">Disponible</small>
                        <h6 class="text-success">${{ "%.2f"|format(card.get_available_credit()) }}</h6>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Pago Mínimo</small>
                        <h6 class="text-warning">${{ "%.2f"|format(card.calculate_minimum_payment()) }}</h6>
                    </div>
                </div>
                
                <div class="mb-3">
                    <small class="text-muted">Próximo Vencimiento</small>
                    <p class="mb-0">{{ card.get_next_due_date().strftime('%d/%m/%Y') }}</p>
                    <small class="{% if card.get_days_until_due() <= 5 %}text-danger{% elif card.get_days_until_due() <= 10 %}text-warning{% else %}text-muted{% endif %}">
                        En {{ card.get_days_until_due() }} días
                    </small>
                </div>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('main.make_payment', card_id=card.id) }}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-credit-card me-1"></i>Hacer Pago
                    </a>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('main.edit_credit_card', card_id=card.id) }}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-edit me-1"></i>Editar
                        </a>
                        <button type="button" class="btn btn-outline-danger btn-sm" 
                                onclick="if(confirm('¿Estás seguro de eliminar esta tarjeta?')) { 
                                    var form = document.createElement('form'); 
                                    form.method = 'POST'; 
                                    form.action = '{{ url_for('main.delete_credit_card', card_id=card.id) }}'; 
                                    document.body.appendChild(form); 
                                    form.submit(); 
                                }">
                            <i class="fas fa-trash me-1"></i>Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-credit-card fa-4x text-muted mb-3"></i>
    <h4 class="text-muted">No tienes tarjetas registradas</h4>
    <p class="text-muted">Agrega tus tarjetas de crédito para gestionar tus deudas</p>
    <a href="{{ url_for('main.create_credit_card') }}" class="btn btn-primary">
        <i class="fas fa-plus me-1"></i>Agregar Tarjeta
    </a>
</div>
{% endif %}
{% endblock %}
